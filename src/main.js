const REGEX_DEFAULT="item>\\s*<title>(?<name>.+?)</title>[\\s\\S]*?<link>(?:<!\\[CDATA\\[)?(?<link>.+?)(?:\\]\\]>)?<[\\s\\S]+?pubDate>(?<date>.+?)<[\\s\\S]+?(?<desc><description>[\\s\\S]+?</description>)";var quickLinksURLs=[],bookmarkColor="#333";function readFile(e,t,n){const o=new XMLHttpRequest;o.overrideMimeType(t),o.open("GET",e,!0),o.onload=()=>{4===o.readyState&&"200"==o.status&&n(o)},o.send(null)}function loadFeeds(e,t,n){const o=document.createElement.bind(document);for(name in e){console.log(name);var[l,r,a]=e[name],a=a||"",s=o("details");s.appendChild(o("summary")).appendChild(document.createTextNode(name));var d=e=>{console.log(e+name);r||(r=REGEX_DEFAULT);for(var l,i,d,c,m,k=e.responseText.matchAll(new RegExp(r,"g")),u=new DOMParser,p=o("ul"),h=0,g=!1;!(d=k.next()).done&&h++<30;)c=d.value.groups,(l=p.appendChild(o("li")).appendChild(o("a"))).className="tooltipBox",l.href=u.parseFromString(a+c.link,"text/html").documentElement.textContent,l.appendChild(document.createTextNode(u.parseFromString(c.name,"text/html").documentElement.textContent)),(i=l.appendChild(o("textarea"))).className="tooltipText",i.setAttribute("readonly","true"),i.appendChild(document.createTextNode(c.date)),c.desc&&(m=u.parseFromString(c.desc,"text/html"),m=u.parseFromString(m.documentElement.textContent.trim(),"text/html"),i.appendChild(document.createTextNode("\n\n"+m.documentElement.textContent))),(!n||new Date(c.date)>=n)&&(l.style.color="cyan",g=!0);g&&(s.appendChild(p),t.appendChild(s))};if(Array.isArray(l))for(i=l.length;i--;)readFile(l[i],"text/xml",d);else readFile(l,"text/xml",d)}}function fetchFavicon(e){return/^(edge|file)/.test(e)?"":(slashIndex=e.slice(8).indexOf("/"),slashIndex>-1&&(e=e.slice(0,slashIndex+9)),"https://www.google.com/s2/favicons?domain="+e)}function atql(e){for(var t=document.getElementById("quick-links"),n=0;n<e.length;n++){var o=document.createElement("div");o.className="bookmark";var l=o.appendChild(document.createElement("a"));l.href=e[n].url,l.style.background="url("+e[n].favIconUrl+") no-repeat center center",l.title=e[n].url,t.appendChild(o),quickLinksURLs.push(e[n].url)}}function q(e){const t=document.createElement.bind(document),n=document.getElementById("sidebar");var o=t("ul");nQuickLinks=quickLinksURLs.length;for(var l=0;l<e.length;l++){var i=e[l].hasOwnProperty("tab")?e[l].tab:e[l];if(i.hasOwnProperty("url")&&!i.url.startsWith("chrome.//")){for(var r=i.url.includes.bind(i.url),a=0;a<nQuickLinks;a++)r(quickLinksURLs[a]);var s=o.appendChild(t("li")).appendChild(t("a"));s.href=i.url,s.appendChild(document.createTextNode(i.title));var d=new Image;d.src=i.favIconUrl?i.favIconUrl:fetchFavicon(i.url),s.insertAdjacentElement("afterbegin",d)}}n.appendChild(o)}function addBookmark(e){e.preventDefault();let t=e.target,n=document.createElement("a"),o=document.createElement("a");n.href=t.querySelector('[placeholder="URL"]').value,o.href=t.querySelector('[placeholder="Ikooni URL"]').value;let l={url:n.href,favIconUrl:o.href};atql([l]);let i=JSON.parse(localStorage.getItem("quick-links"));i.push(l),localStorage.setItem("quick-links",JSON.stringify(i))}function mb(e){e.preventDefault();let t=document.getElementById("quick-links"),n=t.childNodes;for(var o=0;n[++o]!=e.currentTarget;);if(o>1){let e=t.removeChild(n[o]);t.insertBefore(e,n[o-1]);let l=JSON.parse(localStorage.getItem("quick-links"));[l[o-1],l[o-2]]=[l[o-2],l[o-1]],localStorage.setItem("quick-links",JSON.stringify(l))}}function delBookmark(e){e.preventDefault();let t=document.getElementById("quick-links"),n=t.childNodes;for(var o=0;n[++o]!=e.currentTarget;);t.removeChild(n[o]);let l=JSON.parse(localStorage.getItem("quick-links"));l.splice(o-1,1),localStorage.setItem("quick-links",JSON.stringify(l))}function sbce(e,t){let n=document.getElementsByClassName("bookmark");bookmarkColor=bookmarkColor!=e?e:"#333";for(let o=n.length;o--;)n[o].removeEventListener("click",delBookmark),n[o].removeEventListener("click",mb),n[o].style.background=bookmarkColor,t&&bookmarkColor==e&&n[o].addEventListener("click",t)}document.addEventListener("DOMContentLoaded",e=>{const t=document.getElementById.bind(document);var n,o;window.location.origin.startsWith("chrome-extension")?(n="2",o=chrome.storage.sync):window.location.origin.startsWith("moz-extension://")&&(n="unfiled_____",o=browser.storage.sync),void 0!==n&&(chrome.sessions.getRecentlyClosed(q),chrome.topSites.get(q),chrome.bookmarks.getSubTree(n,e=>{let t=e[0].children;q(t.find(e=>"m"==e.title).children),q(t.find(e=>"a"==e.title).children)}));let l=e=>{var n=JSON.parse(e);let l=JSON.parse(localStorage.getItem("quick-links"));l?atql(l):(localStorage.setItem("quick-links",JSON.stringify(n.quickLinks)),atql(n.quickLinks)),linksArrayLen=n.slowLinks.length;for(let e=0;e<linksArrayLen;e++)q(n.slowLinks[e]);const i=t("feeds");var r=()=>{this.removeEventListener("toggle",r);const e="lastcheck";o?(o.get([e],t=>{loadFeeds(n.feeds.Web,i,t[e])}),o.set({[e]:new Date})):(loadFeeds(n.feeds.Web,i,localStorage.getItem(e)),localStorage.setItem(e,new Date))};i.addEventListener("toggle",r)};var i=e=>{e.staticLinks?l(e.staticLinks):readFile("links.json","application/json",e=>{w=e.responseText,o?o.set({staticLinks:w}):localStorage.setItem("staticLinks",w),l(w)})};o?o.get("staticLinks",i):i({staticLinks:localStorage.getItem("staticLinks")}),t("quick-links-add").addEventListener("click",e=>{sbce("#333");let n=t("form-popup"),o=t("quick-links-add").getBoundingClientRect().top;n.style.top=o.toString()+"px",n.style.display="block"!=n.style.display?"block":"none"}),t("form-popup").addEventListener("submit",addBookmark),t("quick-links-move").addEventListener("click",e=>{sbce("darkblue",mb)}),t("quick-links-del").addEventListener("click",e=>{sbce("darkred",delBookmark)});const r=t("noteSection");if(r.hidden=!localStorage.getItem("showNotes"),t("btn-toggle-notes").innerHTML=r.hidden?"&#x25BD;":"&#x25B3;",r.children[0].value=localStorage.getItem("localnotes"),o)o.get(e=>{for(var t=r.children.length;t--;){var n="notes"+t;e[n]||(e[n]=localStorage.getItem(n)),r.children[t].value=e[n]}});else for(var a=r.children.length;a--;)r.children[a].value=localStorage.getItem("notes"+a);var s=()=>{localStorage.setItem("localnotes",r.children[0].value);for(var e=r.children.length;e--;){var t="notes"+e,n=r.children[e].value;void 0!==o?o.set({[t]:n}):localStorage.setItem(t,n)}},d=e=>{r.style.height="100%";var t=parseInt(sessionStorage.getItem("notesview"));if(isNaN(t)||4==t||e.altKey){for(var n=r.children.length;n--;)r.children[n].hidden=!1,r.children[n].style.width="49%",r.children[n].style.height="40%";t=0}else{for(n=r.children.length;n--;)t!=n&&(r.children[n].hidden=!0);let e=r.children[t++];e.hidden=!1,e.style.width="100%",e.style.height="100%",e.scrollIntoView(!0)}sessionStorage.setItem("notesview",t)},c=()=>{r.hidden?(r.hidden=!1,localStorage.setItem("showNotes",1),t("btn-toggle-notes").innerHTML="&#x25B3;"):(r.hidden=!0,localStorage.setItem("showNotes",""),t("btn-toggle-notes").innerHTML="&#x25BD;")};t("btn-save-notes").addEventListener("click",s),t("btn-resize-notes").addEventListener("click",d),t("btn-toggle-notes").addEventListener("click",c),window.addEventListener("keydown",e=>{e.ctrlKey&&"s"==e.key?(e.preventDefault(),s()):e.altKey&&"q"==e.key?(e.preventDefault(),d({altKey:!1})):e.altKey&&"w"==e.key?(e.preventDefault(),d({altKey:!0})):e.altKey&&40==e.keyCode&&(e.preventDefault(),c())});var m=t("searchForm"),k=m.children[0];m.addEventListener("click",e=>{if(e.target.name){let n=e.target.name.split("&");for(var t=0;t<n.length-1;t++){let e=n[t].split("="),o=document.createElement("input");o.setAttribute("type","hidden"),o.setAttribute("name",e[0]),o.setAttribute("value",e[1]),m.appendChild(o)}k.name=n[t]}else k.name="q";m.target=e.ctrlKey?"_blank":"_self"});var u=t("sidebar");document.addEventListener("mousemove",e=>{if(e.altKey)return;let t=u.style.display,n=u.offsetWidth,o=window.innerWidth,l=e.clientX;u.style.display=e.clientY>5&&(o-l<20||t&&o-n-l<0)?"flex":"none"}),k.focus()});